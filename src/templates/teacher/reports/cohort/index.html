{% extends "base.html" %}

{% block content %}
<section class="content-section">
  <h1>Engagement Statistics</h1>
  <div class="stat-container">
  <div class="engagement-table">
  {% if engagement_dict %}
  <table id="engagement_table">
    <thead>
      <tr>
        <th>Time Period</th>
        <th>Number of Users</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Daily</td>
        <td>{{ engagement_dict['daily'] }}</td>
      </tr>
      <tr>
        <td>Weekly</td>
        <td>{{ engagement_dict['weekly'] }}</td>
      </tr>
      <tr>
        <td>Monthly</td>
        <td>{{ engagement_dict['monthly'] }}</td>
      </tr>
    </tbody>
  </table>
</div>
<div class="engagement-card">
  <div class="enagement-card-image">
    <img src="{{ url_for('static', filename='images/session2') }}" alt="session" style="border-radius: 6px 6px 0 0;">
  </div>
  <div class="category"> Average Session Duration </div>
  <h3 class="engagement-card-title"> {{ engagement_dict['overall'] }} minutes</h3>
  {% endif %}
  </div>
</div>
    <form method="POST" class="select-box">
        <label for="assessment_id">Select assessment:</label>
        <select class ="box" name="assessment_id" id="assessment_id">
            {% for assessment in assessments %}
            <option value="{{ assessment.id }}">{{ assessment.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Submit</button>
    </form>
    {% if chosen_assessment %}
    <h1>{{ chosen_assessment.name }} Report</h1>
    <!--<table>
        <tr>
            <th>Total number of attempts</th>
            <th>Total number of students passed</th>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <th>Average number of attempts</th>
            {% endif %}
            <th>Percentage of students passed</th>
            <th>Average Time Taken (MM:SS)</th>
            <th>Average score</th>
            <th>Completion rate</th>
        </tr>
        <tr>
            <td>{{ total_num_of_attempts }}</td>
            <td>{{ total_num_of_students_passed }}</td>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <td>{{ average_attempts }}</td>
            {% endif %}
            <td>{{ (total_num_of_students_passed/total_num_of_attempts * 100 if total_num_of_attempts else 0) | round(1) }}%</td>
            <td>{{ average_time_taken }}</td>
            <td>{{ average_score | round(1) }}%</td>
            <td>{{ completion_rate }}
        </tr>
    </table>-->
    <div class="overall-summary-container">
    <div class="summary-section">
      <h2>Overall Statistics</h2>
    <div class="overall-summary-card">
      <div class="item item--1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="rgba(149,149,255,1)" d="M249.6 471.5c10.8 3.8 22.4-4.1 22.4-15.5V78.6c0-4.2-1.6-8.4-5-11C247.4 52 202.4 32 144 32C93.5 32 46.3 45.3 18.1 56.1C6.8 60.5 0 71.7 0 83.8V454.1c0 11.9 12.8 20.2 24.1 16.5C55.6 460.1 105.5 448 144 448c33.9 0 79 14 105.6 23.5zm76.8 0C353 462 398.1 448 432 448c38.5 0 88.4 12.1 119.9 22.6c11.3 3.8 24.1-4.6 24.1-16.5V83.8c0-12.1-6.8-23.3-18.1-27.6C529.7 45.3 482.5 32 432 32c-58.4 0-103.4 20-123 35.6c-3.3 2.6-5 6.8-5 11V456c0 11.4 11.7 19.3 22.4 15.5z"/></svg>
        <span class="quantity"> {{ total_num_of_attempts }} </span>
        <span class="text text--1"> Total Submissions </span>
      </div>
      <div class="item item--2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="rgba(252,161,71,1)" d="M342.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 178.7l-57.4-57.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l80 80c12.5 12.5 32.8 12.5 45.3 0l160-160zm96 128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 402.7 54.6 297.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l256-256z"/></svg>
        <span class="quantity"> {{ total_num_of_students_passed }} </span>
        <span class="text text--2"> Submissions Passed </span>
      </div>
      <div class="item item--3">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="rgba(66,193,110,1)" d="M374.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-320 320c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l320-320zM128 128A64 64 0 1 0 0 128a64 64 0 1 0 128 0zM384 384a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>
        <span class="quantity"> {{ (total_num_of_students_passed/total_num_of_attempts * 100 if total_num_of_attempts else 0) | round(1) }}% </span>
        <span class="text text--3"> Pass % </span>
      </div>
      <div class="item item--4">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="rgba(220,91,183,1)" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/></svg>
        <span class="quantity"> {{ average_score | round(1) }}% </span>
        <span class="text text--4"> Average Score </span>
      </div>
      <div class="item item--5">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="rgb(209, 43, 255)" d="M176 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h16V98.4C92.3 113.8 16 200 16 304c0 114.9 93.1 208 208 208s208-93.1 208-208c0-41.8-12.3-80.7-33.5-113.2l24.1-24.1c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L355.7 143c-28.1-23-62.2-38.8-99.7-44.6V64h16c17.7 0 32-14.3 32-32s-14.3-32-32-32H224 176zm72 192V320c0 13.3-10.7 24-24 24s-24-10.7-24-24V192c0-13.3 10.7-24 24-24s24 10.7 24 24z"/></svg>
        <span class="quantity"> {{ average_time_taken }} </span>
        <span class="text text--5"> Time Taken </span>
      </div>
      <div class="item item--6">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="rgb(245, 105, 96)" d="M448 160H320V128H448v32zM48 64C21.5 64 0 85.5 0 112v64c0 26.5 21.5 48 48 48H464c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zM448 352v32H192V352H448zM48 288c-26.5 0-48 21.5-48 48v64c0 26.5 21.5 48 48 48H464c26.5 0 48-21.5 48-48V336c0-26.5-21.5-48-48-48H48z"/></svg>
        <span class="quantity"> {{ completion_rate }}% </span>
        <span class="text text--6"> Completion Rate </span>
      </div>
    </div>
  </div>
</div>
    <div class="results-table">
    <h2>Question Results</h2>
    <table id="questions_table">
      <thead>
        <tr>
            <th>ID</th>
            <th>Question</th>
            <th>Correct Answers</th>
            <th>Incorrect Answers</th>
        </tr>
      </thead>
      <tbody>
        {% for result in question_results %}
        <tr>
            <td>{{ result.question.id }}</td>
            <td>{{ result.question.content }}</td>
            <td>{{ result.num_correct }}</td>
            <td>{{ result.num_incorrect }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
    <div class="results-table">
    <h2>Student data</h2>
    <table id="student_table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <th>Number of Attempts</th>
            <th>Correct Attempts</th>
            {% endif %}
            <th>Average Score</th>
            <th>Time Taken (MM:SS)</th>
          </tr>
        </thead>
        <tbody>
          {% for data in student_data %}
            <tr>
              <td>{{ data['id'] }}</td>
              <td>{{ data['name'] }}</td>
              {% if chosen_assessment.assessment_type == 'Formative' %}
              <td>{{ data['num_of_attempts'] }}</td>
              <td>{{ data['num_of_correct_attempts'] }}</td>
              {% endif %}
              <td>{{ data['average_score'] }}%</td>
              <td>{{ data['average_time_taken'] }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
</section>
<script>
  $(document).ready(function() {
    $('#engagement_table').DataTable();
    {% if chosen_assessment %}
    $('#questions_table').DataTable();
    $('#student_table').DataTable();
    {% endif %}
  });
</script>
{% endblock content %}