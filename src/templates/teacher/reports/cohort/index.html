{% extends "base.html" %}

{% block content %}
<section class="content-section" >
    <form method="POST">
        <label for="assessment_id">Select assessment:</label>
        <select name="assessment_id" id="assessment_id">
            {% for assessment in assessments %}
            <option value="{{ assessment.id }}">{{ assessment.name }}</option>
            {% endfor %}
        </select>
        <button type="submit">Submit</button>
    </form>
    {% if chosen_assessment %}
    <h1>{{ chosen_assessment.name }} Report</h1>
    <h2>Overall Results</h2>
    <table>
        <tr>
            <th>Total number of attempts</th>
            <th>Total number of students passed</th>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <th>Average number of attempts</th>
            {% endif %}
            <th>Percentage of students passed</th>
            <th>Average Time Taken</th>
            <th>Average score</th>
            <th>Completion rate</th>
        </tr>
        <tr>
            <td>{{ total_num_of_attempts }}</td>
            <td>{{ total_num_of_students_passed }}</td>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <td>{{ average_attempts }}</td>
            {% endif %}
            <td>{{ (total_num_of_students_passed/total_num_of_attempts * 100 if total_num_of_attempts else 0) | round(1) }}%</td>
            <td>{{ average_time_taken }}</td>
            <td>{{ average_score | round(1) }}%</td>
            <td>{{ completion_rate }}
        </tr>
    </table>
    <h2>Question Results</h2>
    <table>
        <tr>
            <th>Question</th>
            <th>Correct Answers</th>
            <th>Incorrect Answers</th>
        </tr>
        {% for result in question_results %}
        <tr>
            <td>{{ result.question.content }}</td>
            <td>{{ result.num_correct }}</td>
            <td>{{ result.num_incorrect }}</td>
        </tr>
        {% endfor %}
    </table>
    <h2>Student data</h2>
    <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            {% if chosen_assessment.assessment_type == 'Formative' %}
            <th>Number of Attempts</th>
            <th>Correct Attempts</th>
            {% endif %}
            <th>Average Score</th>
            <th>Time Taken</th>
          </tr>
        </thead>
        <tbody>
          {% for data in student_data %}
            <tr>
              <td>{{ data['id'] }}</td>
              <td>{{ data['name'] }}</td>
              {% if chosen_assessment.assessment_type == 'Formative' %}
              <td>{{ data['num_of_attempts'] }}</td>
              <td>{{ data['num_of_correct_attempts'] }}</td>
              {% endif %}
              <td>{{ data['average_score'] }}%</td>
              <td>{{ data['average_time_taken'] }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
</section>
{% endblock content %}